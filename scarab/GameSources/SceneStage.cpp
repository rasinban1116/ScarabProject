/*!
@file ProjectShader.cpp
@brief プロジェクトで使用するシェーダー実体
*/

#include "stdafx.h"
#include "Project.h"

namespace basecross {
	//--------------------------------------------------------------------------------------
	/// タイトル用ステージ実体
	//--------------------------------------------------------------------------------------
	void TitleStage::CreateViewLight() {
		auto ptrView = CreateView<SingleView>();
		//ビューのカメラの設定
		auto ptrMyCamera = ObjectFactory::Create<MyCamera>();
		ptrView->SetCamera(ptrMyCamera);
		ptrMyCamera->SetEye(Vec3(0.0f, 5.0f, -5.0f));
		ptrMyCamera->SetAt(Vec3(0.0f, 0.0f, 0.0f));
		//マルチライトの作成
		auto ptrMultiLight = CreateLight<MultiLight>();
		//デフォルトのライティングを指定
		ptrMultiLight->SetDefaultLighting();
	}

	void TitleStage::CreateTitleSprite() {
		m_txflg = false;
		float size = 0.4;
		auto titlecaharaLogo = AddGameObject<Sprite>(L"TITLELOGO_TX", true,
			Vec2(795.0f * size, 338.0f * size), Vec3(50.0f, 200.0f, 0.0f));
		auto titlebackLogo = AddGameObject<Sprite>(L"TITLEBACK_TX", true,
			Vec2(680.0f, 400.0f), Vec3(0.0f, 0.0f, 0.1f));
		auto startLogo = AddGameObject<Sprite>(L"GAMESTART_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, -150.0f, 0.1f));
		SetSharedGameObject(L"StartLogo", startLogo);

		auto endLogo = AddGameObject<Sprite>(L"GAMEEND_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, -280.0f, 0.1f));
		SetSharedGameObject(L"EndLogo", endLogo);
		//カーソル
		auto cursor = AddGameObject<Sprite>(L"ICON_TX", true,
			Vec2(27.0f, 27.0f), Vec3(150.0f, -150.0f, 0.1f));
		SetSharedGameObject(L"Cousor", cursor);
		//シーン移動に使う画像
		auto seeneTX = AddGameObject<Sprite>(L"SEENE_TX", true,
			Vec2(830.f, 400.0f), Vec3(-1640.0f, 0.f, 0.0f));
		SetSharedGameObject(L"SeeneTX", seeneTX);
	}
	void TitleStage::GameSystemObj() {
		auto Clear = AddGameObject<StageClearObj>(Vec3(0.0f, 3.0f, 0.0f), Vec3(1.0f));
		//PostEvent(0.0f, GetThis<ObjectInterface>(), GetThis<Scene>(), L"ToGameStartScene");
	}
	void TitleStage::System() {
		auto Mauce = App::GetApp()->GetInputDevice().GetControlerVec();

	}
	void TitleStage::OnUpdate() {
		ControlStick();
		m_InputHandler.PushHandle(GetThis<TitleStage>());
		auto cursor = GetSharedGameObject<Sprite>(L"Cousor");
		auto cursorComp = cursor->GetComponent<Transform>();
		auto cursorPos = cursorComp->GetPosition();
		if (m_cursornum == 0) {
			cursorPos.y = -150.f;
		}
		else if (m_cursornum == 1) {
			cursorPos.y = -280.0f;
		}
		cursorComp->SetPosition(cursorPos);
	}

	//コントローラーのスティック
	void TitleStage::ControlStick() {
		auto &app = App::GetApp();
		auto device = app->GetInputDevice();
		auto pad = device.GetControlerVec()[0];
		auto XAPtr = App::GetApp()->GetXAudio2Manager();
		if (!m_CntrolLock) {
			if (pad.fThumbLY <= -0.7) {
				m_cursornum += 1;
				if (m_cursornum == 2)
					m_cursornum = 0;
				m_CntrolLock = true;
			}
			if (pad.fThumbLY >= 0.7f) {
				m_cursornum -= 1;
				if (m_cursornum == -1)
					m_cursornum = 1;
				m_CntrolLock = true;
			}
		}
		else {
			if (pad.fThumbLX == 0.0f) {
				m_CntrolLock = false;
			}
		}
	}

	void TitleStage::OnPushA() {
		if (m_cursornum == 0) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToSerectStage");
		}
		else if (m_cursornum == 1) {
			DestroyWindow(App::GetApp()->GetHWnd());
		}
	}

	void TitleStage::OnCreate() {
		try {
			CreateTitleSprite();
			//物理演算のオンオフ
			SetPhysicsActive(true);
			//ビューとライトの作成
			CreateViewLight();
			//クリアオブジェクト
			GameSystemObj();
		}
		catch (...) {
			throw;
		}
	}

	//--------------------------------------------------------------------------------------
	///クリア用ステージ実体
	//--------------------------------------------------------------------------------------

	void ClearStage::CreateViewLight() {
		auto ptrView = CreateView<SingleView>();
		//ビューのカメラの設定
		auto ptrMyCamera = ObjectFactory::Create<MyCamera>();
		ptrView->SetCamera(ptrMyCamera);
		ptrMyCamera->SetEye(Vec3(0.0f, 5.0f, -5.0f));
		ptrMyCamera->SetAt(Vec3(0.0f, 0.0f, 0.0f));
		//マルチライトの作成
		auto ptrMultiLight = CreateLight<MultiLight>();
		//デフォルトのライティングを指定
		ptrMultiLight->SetDefaultLighting();
	}

	void ClearStage::CreateClearSprite() {
		auto clearbackLogo = AddGameObject<Sprite>(L"CLEARBACK_TX", true,
			Vec2(640.0f, 480.0f), Vec3(0.0f, 0.0f, 0.1f));
		//クリアの文字
		auto clear = AddGameObject<Sprite>(L"CLEAR_TX", true,
			Vec2(250.0f, 70.0f), Vec3(0.0f, 300.0f, 0.0f));

		auto gm = GameManager::GetInstance();

		//ゲームマネージャーから取得したうんこの数をとってくる
		int unkonum = gm->GetUnkoNum();
		//最初にうんこのスコアを表示するところを決める
		Vec3 pos = Vec3(-120.f, 140.f, 0.f);
		//行を何個うんこが表示されたら変わるか
		int num = 4;

		//うんこスコアの表示
		for (int i = 0; i < unkonum; i++) {
			auto unkosp = AddGameObject<Sprite>(L"UNKOIKON_TX", true,
				Vec2(50, 50), Vec3(pos));
			 pos.x += 60.0f;
			 if ( i == num ) {
				 num += 5;
				 pos = Vec3( -120.0f, pos.y -=70.0f, 0.0f);
			 }
		}

		//位置と文字の間隔の設定
		m_strSprite = m_sprite = -30.0f;
		m_spriteif = -90.0f;

		//次のステージ
		auto nextStageLogo = AddGameObject<Sprite>(L"NEXTSTAGE_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite, 0.1f));
		SetSharedGameObject(L"NextStageLogo", nextStageLogo);
		//リトライ
		auto oneMoreLogo = AddGameObject<Sprite>(L"RETRY_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite = m_sprite + m_spriteif, 0.1f));
		SetSharedGameObject(L"OneMoreLogo", oneMoreLogo);
		//ステージセレクト画面
		auto stageSelectLogoa = AddGameObject<Sprite>(L"STAGESELECT_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite = m_sprite + m_spriteif, 0.1f));
		SetSharedGameObject(L"StageSelectLogoa", stageSelectLogoa);
		//スタート画面
		auto startLogo = AddGameObject<Sprite>(L"TITLE_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite = m_sprite + m_spriteif, 0.1f));
		SetSharedGameObject(L"StartLogo", startLogo);

		//カーソルのアイコン
		auto cursor = AddGameObject<Sprite>(L"ICON_TX", true,
			Vec2(35.0f, 35.0f), Vec3(170.0f, -150.0f, 0.1f));
		SetSharedGameObject(L"Cousor", cursor);
	}

	void ClearStage::GameSystemObj() {
		auto Clear = AddGameObject<StageClearObj>(Vec3(0.0f, 3.0f, 0.0f), Vec3(0.5f));
		//PostEvent(0.0f, GetThis<ObjectInterface>(), GetThis<Scene>(), L"ToGameStartScene");
	}

	void ClearStage::System() {
		auto Mauce = App::GetApp()->GetInputDevice().GetControlerVec();
	}

	void ClearStage::OnUpdate() {
		//コントロ―ラーの取得
		m_InputHandler.PushHandle(GetThis<ClearStage>());
		ControlStick();
		//アイコンの移動
		auto cursor = GetSharedGameObject<Sprite>(L"Cousor");
		auto cursorComp = cursor->GetComponent<Transform>();
		auto cursorPos = cursorComp->GetPosition();
		cursorPos.y = m_strSprite + m_spriteif * m_cursornum;;
		cursorComp->SetPosition(cursorPos);
	}

	//コントローラーのスティック
	void ClearStage::ControlStick() {
		auto &app = App::GetApp();
		auto device = app->GetInputDevice();
		auto pad = device.GetControlerVec()[0];
		auto XAPtr = App::GetApp()->GetXAudio2Manager();
		if (!m_CntrolLock) {
			if (pad.fThumbLY <= -0.7) {
				m_cursornum += 1;
				if (m_cursornum == 4)
					m_cursornum = 0;
				m_CntrolLock = true;
			}
			if (pad.fThumbLY >= 0.7f) {
				m_cursornum -= 1;
				if (m_cursornum == -1)
					m_cursornum = 3;
				m_CntrolLock = true;
			}
		}
		else {
			if (pad.fThumbLX == 0.0f) {
				m_CntrolLock = false;
			}
		}
	}

	void ClearStage::OnPushA() {
		if (m_cursornum == 0) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToTitleStage");
		}
		else if (m_cursornum == 1) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToSerectStage");
		}
		else if (m_cursornum == 2) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToGameStage");
		}
		else if (m_cursornum == 3) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToTitleStage");
		}
	}

	void ClearStage::OnCreate() {
		try {
			CreateClearSprite();
			//物理演算のオンオフ
			SetPhysicsActive(true);
			//ビューとライトの作成
			CreateViewLight();
			//クリアオブジェクト
			GameSystemObj();
		}
		catch (...) {
			throw;
		}
	}

	//--------------------------------------------------------------------------------------
	///セレクト用ステージ実体
	//--------------------------------------------------------------------------------------

	void SerectStage::CreateViewLight() {
		auto ptrView = CreateView<SingleView>();
		//ビューのカメラの設定
		auto ptrMyCamera = ObjectFactory::Create<MyCamera>();
		ptrView->SetCamera(ptrMyCamera);
		ptrMyCamera->SetEye(Vec3(0.0f, 5.0f, -5.0f));
		ptrMyCamera->SetAt(Vec3(0.0f, 0.0f, 0.0f));
		//マルチライトの作成
		auto ptrMultiLight = CreateLight<MultiLight>();
		//デフォルトのライティングを指定
		ptrMultiLight->SetDefaultLighting();
	}

	//プレイヤ―の生成
	void SerectStage::CreatePlayer() {
		//プレーヤーの作成
		auto ptrPlayer = AddGameObject<Player>(Vec3(0.0f, 0.5f, -5.0f));
		//シェア配列にプレイヤーを追加
		SetSharedGameObject(L"Player", ptrPlayer);
		ptrPlayer->AddTag(L"Player");
	}


	void SerectStage::CreateStage(){
		auto Grand = AddGameObject<FixedBox>(Vec3(0.0f, -0.5f, 0.0f), Vec3(30.0f, 1.0f, 30.0f));
		//Grand->AddTag(L"Grand");
	}
	void SerectStage::OnUpdate() {
		m_InputHandler.PushHandle(GetThis<SerectStage>());
	}
	void SerectStage::OnPushA() {
		auto ptrScene = App::GetApp()->GetScene<Scene>();
		PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToGameStage");
	}
	void SerectStage::OnPushB() {

	}
	void SerectStage::OnCreateSrectObj() {
		CreateSharedObjectGroup(L"SerectObj");
		AddGameObject<StageSrectObj>(Vec3(-9.0f, 3.0f, -9.0f), Vec3(1.5f, 1.5f, 1.5f));
		AddGameObject<StageSrectObj>(Vec3(-1.0f, 3.0f, -1.0f), Vec3(1.5f, 1.5f, 1.5f));
		AddGameObject<StageSrectObj>(Vec3(6.5f, 3.0f, 9.0f), Vec3(1.5f, 1.5f, 1.5f));
	}




	void SerectStage::OnCreate() {
		try {
			//物理演算のオンオフ
			SetPhysicsActive(true);
			//ビューとライトの作成
			CreateViewLight();
			//ステージの生成
			CreateStage();
			//プレイヤーの生成
			CreatePlayer();
			//ステージセレクトオブジェクトの生成
			OnCreateSrectObj();
		}
		catch (...) {
			throw;
		}
	}

	//--------------------------------------------------------------------------------------
	///ゲームオーバー用ステージ実体
	//--------------------------------------------------------------------------------------

	void GameOverStage::CreateViewLight() {
		auto ptrView = CreateView<SingleView>();
		//ビューのカメラの設定
		auto ptrMyCamera = ObjectFactory::Create<MyCamera>();
		ptrView->SetCamera(ptrMyCamera);
		ptrMyCamera->SetEye(Vec3(0.0f, 5.0f, -5.0f));
		ptrMyCamera->SetAt(Vec3(0.0f, 0.0f, 0.0f));
		//マルチライトの作成
		auto ptrMultiLight = CreateLight<MultiLight>();
		//デフォルトのライティングを指定
		ptrMultiLight->SetDefaultLighting();
	}

	void GameOverStage::CreateStage() {
		AddGameObject<Sprite>(L"GAMEOVER_SCARAB_TX", true,
			Vec2(640.0f, 480.0f), Vec3(0.0f, 0.0f, 0.1f));
		//位置と文字の間隔の設定
		m_strSprite = m_sprite = -30.0f;
		m_spriteif = -90.0f;
		//次のステージ
		auto nextStageLogo = AddGameObject<Sprite>(L"NEXTSTAGE_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite, 0.1f));
		SetSharedGameObject(L"NextStageLogo", nextStageLogo);
		//リトライ
		auto oneMoreLogo = AddGameObject<Sprite>(L"RETRY_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite = m_sprite + m_spriteif, 0.1f));
		SetSharedGameObject(L"OneMoreLogo", oneMoreLogo);
		//ステージセレクト画面
		auto stageSelectLogoa = AddGameObject<Sprite>(L"STAGESELECT_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite = m_sprite + m_spriteif, 0.1f));
		SetSharedGameObject(L"StageSelectLogoa", stageSelectLogoa);
		//スタート画面
		auto startLogo = AddGameObject<Sprite>(L"TITLE_TX", true,
			Vec2(150.0f, 30.0f), Vec3(0.0f, m_sprite = m_sprite + m_spriteif, 0.1f));
		SetSharedGameObject(L"StartLogo", startLogo);

		//カーソルのアイコン
		auto cursor = AddGameObject<Sprite>(L"ICON_TX", true,
			Vec2(35.0f, 35.0f), Vec3(170.0f, 0.0f, 0.1f));
		SetSharedGameObject(L"Cousor", cursor);
		//AddGameObject<FixedPsBox>(Vec3(30.0f, 1.0f, 30.0f), Quat(), Vec3(0.0f, -0.5f, 0.0f));
	}
	void GameOverStage::OnUpdate() {
		m_InputHandler.PushHandle(GetThis<GameOverStage>());
		ControlStick();
		//アイコンの移動
		auto cursor = GetSharedGameObject<Sprite>(L"Cousor");
		auto cursorComp = cursor->GetComponent<Transform>();
		auto cursorPos = cursorComp->GetPosition();
		cursorPos.y = m_strSprite + m_spriteif * m_cursornum;;
		cursorComp->SetPosition(cursorPos);
	}
	//コントローラーのスティック
	void GameOverStage::ControlStick() {
		auto &app = App::GetApp();
		auto device = app->GetInputDevice();
		auto pad = device.GetControlerVec()[0];
		auto XAPtr = App::GetApp()->GetXAudio2Manager();
		if (!m_CntrolLock) {
			if (pad.fThumbLY <= -0.7) {
				m_cursornum += 1;
				if (m_cursornum == 4)
					m_cursornum = 0;
				m_CntrolLock = true;
			}
			if (pad.fThumbLY >= 0.7f) {
				m_cursornum -= 1;
				if (m_cursornum == -1)
					m_cursornum = 3;
				m_CntrolLock = true;
			}
		}
		else {
			if (pad.fThumbLX == 0.0f) {
				m_CntrolLock = false;
			}
		}
	}
	void GameOverStage::OnPushA() {
		//auto ptrScene = App::GetApp()->GetScene<Scene>();
		//PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToOverStage");
		if (m_cursornum == 0) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToTitleStage");
		}
		else if (m_cursornum == 1) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToSerectStage");
		}
		else if (m_cursornum == 2) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToGameStage");
		}
		else if (m_cursornum == 3) {
			auto ptrScene = App::GetApp()->GetScene<Scene>();
			PostEvent(0.0f, GetThis<ObjectInterface>(), ptrScene, L"ToTitleStage");
		}
	}
	void GameOverStage::OnPushB() {

	}

	void GameOverStage::OnCreate() {
		try {
			//物理演算のオンオフ
			SetPhysicsActive(true);
			//ビューとライトの作成
			CreateViewLight();
			//ステージの生成
			CreateStage();
		}
		catch (...) {
			throw;
		}
	}

}



//end basecross
//11/22の俺へ
//お前はいまどんな気持ちでこれを読んでいるのかはわからないが
//きっとこれをお前が呼んでいる時俺はきっともうこの世にはいないだろう
//だが、今のお前に必要だと思いこの文章を残す。
//11/22にお前がやるべきことは
//・その他諸所必要なものの実装
//主にこの3つだ、余裕があれば
//・カメラのスタートからゴールへのカメラの移動
//・うんコインの自動生成
//・うんコインとった時の糞の大きさ調整と速度調整
//もやっておくときっと楽になるだろう
//チームメンバーはごみなので役に立たないだろうから敵の実装ももしかしたらやる羽目になるかもな・・・ﾊﾊｯ
//さぁこれを読んだ俺よ、誰の力を借りてもいいからこれらを11/22に実装しろ
//さすればお前は救われるかもしれない
//									過去の俺から








